import{a as V,B as x,x as N,aZ as M,c as U,f as e,D as c,E as g,I as B,ad as h,by as v,g as i,ca as $,J as f,o as L}from"./index-CIrkHTpR.js";import{t as S,s as T}from"./request-DkoUKwso.js";import{E as m}from"./index-CbHfYLf6.js";const D={class:"login"},K={class:"form"},P={class:"opt"},R={class:"label"},A={class:"inpbox"},F={class:"opt"},J={class:"label"},O={class:"inpbox"},Z={class:"opt"},j={class:"label"},q={class:"inpbox"},W=V({__name:"LoginView",setup(z){let w=x(),r,d=100,p=40,y=M.url,o=x({account:"",password:"",captcha:""});const b=$(),k=async()=>{let{account:t,password:s,captcha:u}=o.value;if(t&&s&&u){let l;await S({captcha:u}).then(a=>{a.code==200?l=!0:m({type:"error",message:a.msg})}),l&&await T({account:t,password:s}).then(a=>{let{code:_,msg:n}=a;if(_==200){let{nickName:C,token:E}=a;localStorage.setItem("NICK_NAME",C),localStorage.setItem("TOKEN",E),m({type:"success",message:a.msg}),setTimeout(()=>{b.replace({path:"/"})},150)}else m({type:"error",message:a.msg})})}else m({type:"error",message:"输入框不能为空"})};N(()=>{let t=w.value,s=new Image;s.src=`${y}/api/verify/captcha`,t&&(t.width=d,t.height=p,r=t.getContext("2d"),s.onload=()=>{r.drawImage(s,0,0,d,p)})});const I=()=>{let t=new Image;t.src=`${y}/api/verify/captcha?${Math.random()}`,r.clearRect(0,0,d,p),t.onload=()=>{r.drawImage(t,0,0,d,p)}};return(t,s)=>{const u=f("User"),l=B,a=f("Lock"),_=f("Picture");return L(),U("div",D,[e("div",K,[s[3]||(s[3]=e("div",{class:"title"},[e("span",null,"管理员登录")],-1)),e("div",P,[e("div",R,[c(l,null,{default:g(()=>[c(u)]),_:1})]),e("div",A,[h(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=n=>i(o).account=n),placeholder:"请输入账号"},null,512),[[v,i(o).account]])])]),e("div",F,[e("div",J,[c(l,null,{default:g(()=>[c(a)]),_:1})]),e("div",O,[h(e("input",{type:"password","onUpdate:modelValue":s[1]||(s[1]=n=>i(o).password=n),placeholder:"请输入密码"},null,512),[[v,i(o).password]])])]),e("div",Z,[e("div",j,[c(l,null,{default:g(()=>[c(_)]),_:1})]),e("div",q,[h(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=n=>i(o).captcha=n),placeholder:"请输入验证码"},null,512),[[v,i(o).captcha]])]),e("div",{class:"vcode",onClick:I},[e("canvas",{ref_key:"canvas",ref:w},null,512)])]),e("div",{class:"opt",style:{"margin-top":"24px"}},[e("button",{class:"btn",onClick:k},"登录")])])])}}});export{W as default};
